<div class="sales-page">
  <div class="page-header">
    <h1>Satışlar</h1>
    <button class="refresh-btn" (click)="load()" [disabled]="isLoading">
      {{ isLoading ? 'Yükleniyor...' : 'Yenile' }}
    </button>
  </div>
  
  <!-- Filtreler -->
  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Ürün veya müşteri adıyla ara..."
          class="filter-input"
        />
      </div>
      
      <div class="filter-group">
        <input 
          type="date" 
          [(ngModel)]="dateFilter"
          class="filter-input"
        />
      </div>
      
      <div class="filter-group">
        <select 
          [(ngModel)]="customerFilter"
          class="filter-input"
        >
          <option value="">Tüm Müşteriler</option>
          @for (customer of uniqueCustomers; track customer) {
            <option [value]="customer">{{ customer }}</option>
          }
        </select>
      </div>
      
      <div class="filter-group">
        <select 
          [(ngModel)]="statusFilter"
          class="filter-input"
        >
          <option value="">Tüm Durumlar</option>
          <option value="1">Aktif</option>
          <option value="0">Pasif</option>
        </select>
      </div>
      
      <button type="button" class="clear-filters-btn" (click)="clearFilters()">
        Temizle
      </button>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading">Yükleniyor...</div>
  }

  @if (!isLoading && errorMessage) {
    <div class="error-message">{{ errorMessage }}</div>
  }

  @if (!isLoading && filteredSales.length > 0) {
    <table class="sales-table">
      <thead>
        <tr>
          <th>Müşteri</th>
          <th>Ürün Adı</th>
          <th>Miktar</th> 
          <th>Toplam Tutar</th>
          <th>Tarih</th>
          <th>Ödeme Tipi</th>
          <th>Durum</th>
          <th>İşlemler</th>
        </tr>
      </thead>
      <tbody>
        @for (sale of filteredSales; track sale.id) {
          <tr class="sale-row">
            <td (click)="testClick(); onSaleClick(sale)">{{sale.storeName || sale.customer?.name || '-' }}</td>
            <td (click)="onSaleClick(sale)">{{ sale.notes || '-' }}</td>
            <td (click)="onSaleClick(sale)">{{ sale.paidAmount || '-' }}</td> 
            <td (click)="onSaleClick(sale)">{{ sale.totalAmount || '-' }}</td>
            <td (click)="onSaleClick(sale)">{{ (sale.createdAt || sale.saleDate) || '-' }}</td>
            <td (click)="onSaleClick(sale)">{{ statusLabel(sale.paymentType) }}</td> 
            <td>
                
                  <button type="button" class="delete-btn"  >
                    {{ sale.isActive ? 'Aktif' : 'Pasif' }}
                  </button>

            </td>
            <td>
              <button type="button" class="delete-btn" (click)="onDelete(sale)" [disabled]="deletingId === getId(sale) || isLoading">
                {{ deletingId === getId(sale) ? 'Siliniyor...' : 'Sil' }}
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (!isLoading && filteredSales.length === 0 && sales.length > 0) {
    <div class="no-results">
      Filtrelere uygun satış bulunamadı.
    </div>
  }

  @if (!isLoading && sales.length === 0 && !errorMessage) {
    <div class="no-results">
      Gösterilecek satış bulunamadı.
    </div>
  }
</div>